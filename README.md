## Table of Contents

1.  [Project Setup](https://www.google.com/search?q=%23project-setup 'null')

2.  [Development Workflow](https://www.google.com/search?q=%23development-workflow 'null')

3.  [Database Schema](https://www.google.com/search?q=%23database-schema 'null')

4.  [API Endpoint Reference](https://www.google.com/search?q=%23api-endpoint-reference 'null')

## Project Setup

Follow these steps to get the development environment up and running on your local machine.

### Installation Steps

1.  **Clone the Repository**

    ```
    git clone git@github.com:eslamalii/expansion-management-api.git
    cd expansion-management-api

    ```

2.  **Install Dependencies**

    ```
    npm install

    ```

3.  **Configure Environment Variables** Copy the example environment file to create your local configuration.

    ```
    cp .env.example .env

    ```

    Now, open the `.env` file and fill in the required values. For local development, the database hosts should be set to `localhost`. You will need to sign up for a free account at [Mailtrap.io](https://mailtrap.io 'null') to get your SMTP credentials for testing emails.

    **Example `.env` configuration:**

    ```
    #Application
    APP_PORT=3000

    #JWT Authentication
    JWT_SECRET=your-super-secret-key
    JWT_EXPIRATION=3600s

    #MySQL Database
    DB_HOST=localhost
    DB_PORT=3306
    DB_USERNAME=user
    DB_PASSWORD=password
    DB_DATABASE=expansion_management
    DB_ROOT_PASSWORD=rootpassword

    #MongoDB Database
    MONGO_HOST=localhost
    MONGO_PORT=27017
    MONGO_USER=mongoadmin
    MONGO_PASSWORD=secret
    MONGO_DB_NAME=expansion_management
    MONGODB_URI=mongodb://mongoadmin:secret@localhost:27017/expansion_management?authSource=admin


    #Redis for BullMQ
    REDIS_HOST=localhost
    REDIS_PORT=6379

    #SMTP for Email Notifications
    EMAIL_PROVIDER=nodemailer
    SMTP_HOST=sandbox.smtp.mailtrap.io
    SMTP_PORT=587
    SMTP_USER=<SMTP_USER>
    SMTP_PASS=<>SMTP_PASS>
    SMTP_FROM_EMAIL="<from@example.com>"


    ```

4.  **Start the Development Environment** This is the main command to start everything. It will launch the Docker containers for the databases, wait for them to be ready, seed the initial data, and then start the NestJS server.

    ```
    npm run dev:reset
    npm run dev

    ```

    Your server should now be running on `http://localhost:3000`.

## Development Workflow

This project uses a hybrid development model: the NestJS server runs locally for fast hot-reloading, while the databases (MySQL, MongoDB, Redis) run as stable services in Docker. The `npm` scripts are designed to manage this workflow seamlessly.

### Key NPM Scripts

- **`npm run dev`** This is your primary command for daily development. It starts the database containers (if they aren't already running), waits for them to be ready, and then starts the NestJS server in watch mode.

- **`npm run dev:reset`** Use this command to completely reset your environment. It will stop and delete the database containers and their data, then run the full `dev` initialization sequence, including re-seeding the database. This is useful when you need a clean slate.

- **`npm run db:down`** This command gracefully stops and removes the database containers. Your data will be preserved in Docker volumes.

- **`npm run db:clean`** This is a destructive command that stops the containers and **deletes their associated data volumes**. Use this when you want to completely wipe the databases.

## Database Schema

The database schema is defined by the TypeORM entities (`src/**/*.entity.ts`) and is automatically created and synchronized when the application starts (`synchronize: true`). Below is a reference of the SQL schema generated by the entities.

#### `client` Table

```
CREATE TABLE `client` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `company_name` VARCHAR(255) NOT NULL UNIQUE,
    `contact_email` VARCHAR(255) NOT NULL UNIQUE,
    `password` VARCHAR(255) NOT NULL,
    `role` VARCHAR(255) NOT NULL DEFAULT 'client',
    PRIMARY KEY (`id`)
);

```

#### `vendor` Table

```
CREATE TABLE `vendor` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(255) NOT NULL,
    `countries_supported` JSON NOT NULL,
    `services_offered` JSON NOT NULL,
    `rating` DECIMAL(2, 1) NOT NULL,
    `response_sla_hours` INT NOT NULL,
    PRIMARY KEY (`id`)
);

```

#### `project` Table

```
CREATE TABLE `project` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `country` VARCHAR(255) NOT NULL,
    `services_needed` TEXT NOT NULL,
    `budget` DECIMAL(10, 2) NOT NULL,
    `status` ENUM('active', 'completed', 'cancelled') NOT NULL DEFAULT 'active',
    `clientId` INT NULL,
    PRIMARY KEY (`id`),
    FOREIGN KEY (`clientId`) REFERENCES `client`(`id`)
);

```

#### `match` Table

```
CREATE TABLE `match` (
    `id` INT NOT NULL AUTO_INCREMENT,
    `score` DECIMAL(5, 2) NOT NULL,
    `create_at` DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    `projectId` INT NULL,
    `vendorId` INT NULL,
    PRIMARY KEY (`id`),
    FOREIGN KEY (`projectId`) REFERENCES `project`(`id`) ON DELETE CASCADE,
    FOREIGN KEY (`vendorId`) REFERENCES `vendor`(`id`) ON DELETE CASCADE
);

```

## API Endpoint Reference

A complete and interactive list of all endpoints is available in the Postman collection.

[Complete API Documentation](https://documenter.getpostman.com/view/48052721/2sB3HhthtL)

### Public / Authentication

- `POST /auth/register`

- `POST /auth/login`

### Clients (Role: `admin`)

- `GET /clients`

- `GET /clients/:id`

- `PATCH /clients/:id`

- `DELETE /clients/:id`

### Projects

- `POST /projects`

- `GET /projects`

- `GET /projects/:id`

- `PATCH /projects/:id`

- `DELETE /projects/:id` `Admin`

### Vendors (Role: `admin` )

- `POST /vendors`

- `GET /vendors`

- `GET /vendors/:id`

- `PATCH /vendors/:id`

- `DELETE /vendors/:id`

### Documents (MongoDB) (Role: `client` or `admin`)

- `POST /documents`

- `GET /documents`

### Matching Engine (Role: `client` or `admin`)

- `GET /matches/project/:projectId`

- `POST /matches/project/:projectId/rebuild`

### Analytics (Role: `admin` only)

- `GET /analytics/top-vendors`
